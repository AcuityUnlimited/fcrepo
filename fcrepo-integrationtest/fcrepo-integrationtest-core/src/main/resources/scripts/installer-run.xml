<project name="installer-run">

  <target name="install">
    <delete dir="${fedora.home}" failonerror="false" />
    <mkdir dir="${fedora.home}" />
    
    <condition property="maven.opts" value="${maven.env.opts}" else=" ">
      <and>
        <isset property="maven.env.opts"/>
        <not>
          <equals arg1="${maven.env.opts}" arg2="${env.MAVEN_OPTS}"/>
        </not>
      </and>
    </condition>
    
    <condition property="fedora.install.properties.extra" value=" ">
      <not>
        <isset property="fedora.install.properties.extra"/>
      </not>
    </condition>
    
    <echo>Installing Fedora</echo>
    <echo>Installer: ${basedir}/target/ext/fcrepo-installer/fcrepo-installer-${fedora.install.version}.jar</echo>
    <echo>Properties: ${fedora.install.properties} ${fedora.install.properties.extra}</echo>
    
    <java
      jar="${basedir}/target/ext/fcrepo-installer/fcrepo-installer-${fedora.install.version}.jar"
      fork="true" spawn="false" failonerror="true">
      <jvmarg line="${maven.opts}"/>
      <arg line="${fedora.install.properties} ${fedora.install.properties.extra}" />
      <env key="FEDORA_HOME" value="${fedora.home}" />
      <env key="CATALINA_HOME" value="${tomcat.home}" />
    </java>
  </target>
  
  <target name="clearSQL">
    <echo>Clearing SQL database</echo>
 	<java classpath="${fedora.home}/server/bin/fcrepo-server-${fedora.install.version}-cli-loader-main.jar"
          classname="org.fcrepo.server.utilities.rebuild.cli.CLILoader" fork="true" spawn="false" failonerror="true">
 	  <arg line="org.fcrepo.server.test.ClearSQLDatabase" />
 	  <env key="FEDORA_HOME" value="${fedora.home}" />
 	  <sysproperty key="fedora.web.inf.lib" value="${fedora.home}/install/fedorawar/WEB-INF/lib"/>
 	</java>
  </target>

</project>
